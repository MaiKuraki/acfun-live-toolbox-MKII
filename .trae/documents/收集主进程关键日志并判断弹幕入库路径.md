## 快速结论

* 你提供的日志是 WebSocket 的 ZtLiveScStateSignal（状态信号），不是弹幕/礼物/点赞事件，因此无法证明“弹幕已到达并入库”。要验证弹幕采集与保存，我们需要主进程按约定输出的结构化日志。

## 需要你提供的日志（按时间顺序）

* 连接阶段（Adapter）：

  * `[Adapter] connect start roomId=<rid>`

  * `[Adapter] danmu start roomId=<rid> sessionId=<sid>`

  * `[Adapter] connect ok roomId=<rid> state=CONNECTED`

* 事件到达与标准化（Adapter）：

  * `[Adapter] event type=<type> roomId=<rid> ts=<ts>`（原始事件分类）

  * `[Adapter] unified type=<type> roomId=<rid> ts=<ts> userId=<uid> userName=<name>`（标准化后的统一事件）

* 入库（RoomManager / EventWriter）：

  * `[Room] enqueue roomId=<rid> type=<type> ts=<ts>`

  * `[Writer] enqueue size=<queueSize>`

  * `[Writer] flush begin batch=<size>` / `[Writer] flush end batch=<size> ok`

  * `[Writer] commit ok count=<N>`

* 查询（ApiServer）：

  * `[API] /api/events params room_id=<rid> page=<p> pageSize=<ps> type=<t> total=<total> items=<len>`

  * `[API] /api/events/rooms rooms=<len>`

## 操作说明

* 启用日志：在启动主进程前设置环境变量 `ACFRAME_DEBUG_LOGS=1`

* 连接房间：通过 UI 的连接操作或 IPC `room.connect`，确保房间进入 `open` 状态

* 触发一段时间采集后，将上述日志片段（尤其是 Adapter/Room/Writer/API 的行）粘贴给我

## 辅助验证（可选）

* 端点检查：

  * `GET /api/debug/db-info` 应返回 `dbPath / eventsCount / latestEventTs / latestRoomIds / roomsMetaCount`

  * `GET /api/debug/events/sample?limit=20` 应返回最近事件的 `id/room_id/type/ts`

* IPC 检查：`room.list` 应显示房间 `status='open'` 且 `eventCount` 持续增长

## 判定逻辑（我收到日志后将按此分析）

* 若无 `[Adapter] danmu start`：弹幕服务未启动（可能是 token/roomId 问题或连接路径未走适配器），需要确认连接流程

* 有 `[Adapter] event` 但无 `[Adapter] unified`：上游事件未进入统一标准化，需确认类型映射

* `/api/debug/db-info`

* 有 `[Writer] commit ok` 但 `[API] /api/events ... items=0`：查询过滤参数不匹配或房间ID不一致

## 说明

* 你当前提供的 ZtLiveScStateSignal 属于状态信号，不在弹幕写库路径的白名单（弹幕/礼物/点赞/进入/关注）。这解释了“有 WebSocket 状态日志但查询无弹幕”的现象。先按上述日志链路确认弹幕事件是否进入统一路径；如需保存状态信号，可在后续增加映射为 `system` 类型入库（待你确认再做）。

