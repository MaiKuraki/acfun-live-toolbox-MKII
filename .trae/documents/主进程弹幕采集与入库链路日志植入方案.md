## 目标
- 在主进程关键节点输出结构化日志，方便你粘贴终端日志进行问题定位
- 覆盖事件获取→标准化→入库→查询端到端链路

## 日志开关
- 统一受 `process.env.ACFRAME_DEBUG_LOGS === '1'` 控制
- 默认关闭；需要时在启动环境设置该变量即可启用

## 打点位置与日志格式
- Adapter（packages/main/src/adapter/AcfunAdapter.ts）
  - connect 开始/成功/失败
    - `[Adapter] connect start roomId=<rid>`
    - `[Adapter] connect ok roomId=<rid> state=CONNECTED`
    - `[Adapter] connect fail roomId=<rid> err=<message>`
  - startDanmuService 启动成功（含会话ID）
    - `[Adapter] danmu start roomId=<rid> sessionId=<sid>`
  - handleDanmuEvent 分发（每条事件简要）
    - `[Adapter] event type=<type> roomId=<rid> ts=<ts>`
  - emitUnifiedEvent 标准化后统一事件
    - `[Adapter] unified type=<type> roomId=<rid> ts=<ts> userId=<uid> userName=<name>`

- RoomManager（packages/main/src/rooms/RoomManager.ts）
  - statusChange（连接/断开/错误/重连）
    - `[Room] status roomId=<rid> status=<status>`
  - on 'event' 进入写队列前
    - `[Room] enqueue roomId=<rid> type=<type> ts=<ts>`

- EventWriter（packages/main/src/persistence/EventWriter.ts）
  - enqueue 后队列长度
    - `[Writer] enqueue size=<queueSize>`
  - flushQueue 开始/结束
    - `[Writer] flush begin batch=<size>`
    - `[Writer] flush end batch=<size> ok`
  - writeBatch 提交成功/失败
    - `[Writer] commit ok count=<N>` 或 `[Writer] commit fail err=<message>`

- DatabaseManager（packages/main/src/persistence/DatabaseManager.ts）
  - initialize 已有路径日志 `Database connected at: <dbPath>` 保留即可

- ApiServer（packages/main/src/server/ApiServer.ts）
  - GET /api/events 请求/响应简要
    - `[API] /api/events params=<room_id, page, pageSize, type?> total=<result.total> items=<result.items.length>`
  - GET /api/events/rooms
    - `[API] /api/events/rooms rooms=<len>`

- QueryService（packages/main/src/persistence/QueryService.ts）
  - 查询统计（可选，避免重复）
    - `[Query] total=<count> page=<page> size=<pageSize> where=<condCount>`

## 实施要点
- 仅打印核心字段；不输出完整 `raw` 内容，避免日志过大
- 所有日志使用 `console.log` 单行文本，前缀统一（Adapter/Room/Writer/API/Query）便于检索
- 避免热路径过度日志：Adapter 的 per-event 日志保留精简字段；若日志量过大，可按需降低

## 验证步骤
1. 启用环境变量后启动主进程：`ACFRAME_DEBUG_LOGS=1`
2. 连接房间，观察终端输出：connect→danmu start→event→enqueue→flush/commit→API 查询返回总数
3. 将终端输出贴给我，我根据日志定位是否事件到达、是否入库、查询参数是否匹配等问题

请确认方案，我将按照上述位置植入日志并开启可控的调试开关。