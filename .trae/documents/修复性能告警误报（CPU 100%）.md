## 根因解释
- 性能监控首次采样将 CPU 百分比的分母算成 0，得到固定 100%，触发“critical”告警。
  - 位置：`packages/main/src/plugins/PluginPerformanceMonitor.ts:250-276`，分母写为 `(now - (this.getLastMetricsTime(pluginId) || now))`；首次采样没有历史，分母=0。
- `PluginManager` 的性能告警处理在遇到 `critical` 时会直接暂停插件（标记错误），因此“启用一段时间后显示插件错误”。
  - 位置：`packages/main/src/plugins/PluginManager.ts:392-406`，`critical` → `suspendPlugin()`。
- 日志“init 完成后立即性能告警 CPU 100%”与该逻辑完全匹配：首次采样即 100% → 触发暂停 → 显示插件错误。

## 修复项
1) 修正 CPU 百分比计算窗口
- 使用 `pluginStartTimes` 作为首次采样基准；后续采样用上一次指标时间。
- 公式：
  - `const startTime = this.pluginStartTimes.get(pluginId) || now;`
  - `const lastTs = this.getLastMetricsTime(pluginId) || startTime;`
  - `const elapsedMs = Math.max(1, now - lastTs);`
  - `const cpuPercent = ((cpuUsage.user + cpuUsage.system)/1e6) / (elapsedMs/1000) * 100;`
- 位置：`packages/main/src/plugins/PluginPerformanceMonitor.ts:250-276`。

2) 抑制首次采样告警与误判
- 在 `checkPerformanceAlerts` 中若历史长度 < 2 则不发出 CPU 告警；或将首次样本的 CPU 视为 0。
- 位置：`packages/main/src/plugins/PluginPerformanceMonitor.ts:393-432`。

3) 稳健暂停策略（可选，避免偶发尖峰即暂停）
- 在 `PluginManager` 的性能告警处理处，要求连续 ≥2 次 `critical` 后才暂停；或只在 `error` 等级以上暂停，`critical` 记录但不立即停。
- 位置：`packages/main/src/plugins/PluginManager.ts:392-406`。

## 验证
- 启用 obs-assistant 后等待两个监控周期（默认 5s×2），不再出现“启用后很快显示插件错误”。
- 观察 `metrics-collected` 与 `performance-alert`：首次采样不告警；后续 CPU 百分比随负载变化，只有持续异常才触发暂停。

## 影响范围
- 仅影响性能监控与告警策略，不改变插件执行逻辑。
- 修复遵循“删除旧兼容逻辑”的原则，不保留错误路径回退。