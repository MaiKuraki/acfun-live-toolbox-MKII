## 问题定位
- 渲染层状态混淆：详情接口返回的“是否直播中”被当成“采集连接状态”，导致界面显示“弹幕获取中”，但实际未连接采集（packages/renderer/src/stores/room.ts:247–268 将详情的 `status` 覆盖了 `room.status`）。
- 订阅端口错误：渲染层直接使用 `fetch('/api/...')` 与 `ws://localhost:8080/8081/8082/ws`（packages/renderer/src/pages/LiveDanmuPage.vue:331、385、416–421），未使用主进程配置端口（packages/main/src/index.ts:141；ApiServer 根路由返回 `websocket_endpoint`，packages/main/src/server/ApiServer.ts:147）。导致历史弹幕查询与 WebSocket 推送均连错端口。
- 采集链路确认：主进程采集与写库链路完整（AcfunAdapter 启动采集 packages/main/src/adapter/AcfunAdapter.ts:600–626 → RoomManager 入队 packages/main/src/rooms/RoomManager.ts:212–224 → EventWriter 事务写入 packages/main/src/persistence/EventWriter.ts:76–135）。若仍无数据，可能是上游认证或房间ID不正确。

## 解决方案
- 渲染层仅用 `room.status` 映射采集连接状态；`isLive` 独立显示“直播中”，不再用详情的 `status` 覆盖连接状态。
  - 修改 packages/renderer/src/stores/room.ts：在 `refreshRoomStatus` 与 `addRoom` 的详情合并逻辑中，移除对 `status` 字段的覆盖，改为只更新 `viewerCount/likeCount/title/cover/streamer` 等；保留 `isLive` 单独字段用于 UI 展示。
- 统一 API 访问与 WS 订阅端口。
  - 修改 packages/renderer/src/pages/LiveDanmuPage.vue：
    - 将 `fetch('/api/...')` 改为 `window.electronApi.http.get('/api/events', params)` 与 `window.electronApi.http.get('/api/events/rooms')`。
    - 调用 `window.electronApi.http.get('/')` 读取 `websocket_endpoint`，解析端口后连接 `ws://127.0.0.1:<port>/ws`，去掉 8080/8081/8082 的硬编码。
- 保持主进程逻辑不变；若连接失败，渲染层不误报“采集中”，并可通过 `room.status` 正确显示 `connecting/error/closed/open`。

## 实施步骤
1. 更新 room 状态合并逻辑：
   - 修改 packages/renderer/src/stores/room.ts 的 `refreshRoomStatus` 与 `addRoom`，去掉详情 `status` 覆盖（保留 `isLive`）。
2. 统一 HTTP/WS 端口：
   - 修改 packages/renderer/src/pages/LiveDanmuPage.vue：
     - 替换历史数据与房间列表的 `fetch` 为 `window.electronApi.http.get`。
     - 在 `connectWebSocket` 中先请求 `/`，解析返回的 `websocket_endpoint` 端口，再建立 WS 连接。
3. 校验采集链路：
   - 在 UI 端通过 `window.electronApi.room.status(roomId)` 验证状态为 `open` 后再展示“弹幕获取中”。

## 验证方案
- 添加两间房并连接：
  - UI 显示“直播中”取决于 `isLive`，显示“弹幕获取中”仅在 `room.status === 'connected'`。
- 历史弹幕：
  - `window.electronApi.http.get('/api/events', { room_id: <roomId>, pageSize: 50 })` 返回 `total > 0` 与 `items` 列表。
- WebSocket 实时：
  - `LiveDanmuPage` 收到事件后列表增长；房间“最后活动时间”更新（packages/renderer/src/stores/room.ts:569–579）。
- 数据库路径确认：
  - 通过 `window.electronApi.db.getPath()` 查看 `events.db` 位置，文件大小随采集增长。

## 可能风险与兼容
- 若上游 `acfunlive-http-api` 需要登录，未认证将导致采集失败；此时 UI 正确显示 `error/closed`，不会误报“采集中”。
- 不保留旧版端口回退逻辑（按用户规则），彻底移除 8080/8081/8082 的硬编码。