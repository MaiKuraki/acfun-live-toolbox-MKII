## 更正理解
- 渲染进程不负责实时弹幕展示，仅负责房间注册与采集状态显示/控制。
- 插件获取弹幕通过与主进程建立 EventSource（SSE）订阅。
- 除主进程外，其余页面不涉及 WebSocket。

## 问题定位
- 状态混淆：详情接口的“是否直播中”覆盖了采集连接状态，导致 UI 显示“弹幕获取中”但实际未连接采集（packages/renderer/src/stores/room.ts:247–268）。
- API 访问方式不统一：渲染层直接 `fetch('/api/...')` 未使用主进程配置端口（packages/renderer/src/pages/LiveDanmuPage.vue:331、385），可能造成查询不到历史弹幕。
- 主进程采集链路完整（AcfunAdapter 启动采集 packages/main/src/adapter/AcfunAdapter.ts:600–626 → RoomManager 入队 packages/main/src/rooms/RoomManager.ts:212–224 → EventWriter 事务写入 packages/main/src/persistence/EventWriter.ts:76–135），若仍无数据需核查房间ID与认证。

## 解决方案
- 严格区分两种状态：
  - 采集连接状态只取自 `window.electronApi.room.status(roomId)`，映射 `connecting/open/closed/error`。
  - 直播状态（是否直播中）由详情接口 `isLive` 单独字段展示，不再覆盖连接状态。
- 统一 HTTP 访问：
  - 将所有 `/api/...` 查询切换为 `window.electronApi.http.get(path, params)`，保证端口与主进程一致（packages/main/src/index.ts:141）。
- 移除渲染层对 WebSocket 的使用：
  - 删除 LiveDanmuPage 中 WS 相关代码（packages/renderer/src/pages/LiveDanmuPage.vue:416–453），改为仅展示历史数据与导出；实时订阅由插件的 SSE 负责。

## 实施步骤
1. 修改 packages/renderer/src/stores/room.ts：
   - 在 `refreshRoomStatus` 与 `addRoom` 的详情合并逻辑中，移除对 `status` 字段的覆盖；保留/更新 `isLive`、`viewerCount`、`likeCount`、`title`、`coverUrl`、`streamer` 等。
2. 修改 packages/renderer/src/pages/LiveDanmuPage.vue：
   - 将历史房间与历史弹幕的 `fetch` 改为 `window.electronApi.http.get`；去除 `ws://localhost:8080/8081/8082/ws` 连接与相关重连逻辑。
   - 页面仅做历史数据查询与导出，不做实时展示。

## 验证方案
- 添加两间房并连接：界面仅在 `room.status === 'connected'` 时显示“弹幕获取中”；`isLive` 独立显示“直播中”。
- 历史弹幕：`window.electronApi.http.get('/api/events', { room_id: <roomId>, pageSize: 50 })` 返回 `total > 0` 与 `items` 列表。
- 数据库路径：`window.electronApi.db.getPath()` 确认 `events.db` 文件位置与大小随采集增长。
- 插件实时：保持现有 SSE 架构，不改动主进程。

## 风险与处理
- 若 `acfunlive-http-api` 在未登录下拒绝采集，UI 会正确显示 `error/closed`；此时需先完成二维码登录再连接房间。