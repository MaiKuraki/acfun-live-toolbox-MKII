## 目标与范围
- 在 `Console.vue` 页面实现滚动日志视图，展示主进程与渲染进程的实时日志：console 输出、插件生命周期、房间连接等。
- 支持筛选错误日志、关键字搜索、来源过滤、时间范围选择。
- 支持导出指定时间段内的错误日志（JSON）。
- 顶部统计展示：overlay 连接数量、plugin window 连接数量、已加载插件数、WebSocket 客户端数。
- 日志仅在本次会话内展示，无需持久化到数据库（UI层内存缓存）。

## 数据来源与接口
- 主进程日志：扩展 LogManager，在写入日志时同时向 `DataManager` 发布到频道 `system:logs`；新增 SSE 订阅接口 `/sse/system/logs` 推送实时日志。
- 历史/查询接口：新增 `/api/logs` 支持查询最近日志（参数：`level`、`source`、`from_ts`、`to_ts`、`limit`）。
- 导出接口：新增 `/api/logs/export`，按时间段导出错误日志为 JSON 文件并返回保存路径；渲染层可直接使用保存对话框自定义路径写入。
- 统计数据：
  - overlay 连接数：IPC `monitoring.pageStatus.query` 返回各插件 `connectedCount`，渲染层汇总总和。
  - plugin window 连接数：IPC `plugin.window.list` 返回窗口列表，取长度。
  - 加载插件数：IPC `plugin.stats` 或 `plugin.list` 取已安装/启用数量。
  - WebSocket 客户端数：HTTP `GET /` 或 `GET /api/console/data` 的 `websocket_clients` 字段。
- 回退策略：若 SSE 不可用，使用 IPC `system.getSystemLog(count)` 轮询追加（不存储、只维护 UI 缓冲）。

## 渲染层实现（Console.vue）
- 顶部统计条：采用 TDesign `t-card`+栅格，定时刷新统计（每 15s）。
- 日志视图：
  - 使用虚拟列表或可滚动容器（1k 条内），自动滚动到底部；支持暂停滚动。
  - 行展示字段：`timestamp`、`level`、`source`、`message`；错误行高亮。
  - 筛选控件：`level` 多选、`source` 多选、文本搜索、时间范围选择。
  - 操作：清空当前会话日志、复制单行、导出错误日志（时间段）。
- 导出逻辑：
  - 由筛选条件构造请求到 `/api/logs` 或直接从当前 UI 缓冲中过滤（遵循“仅会话”要求）。
  - 用户选择保存路径：`dialog.showSaveDialog`；写入 `fs.writeFile` 为 JSON（不包含敏感字段）。
- 命令区与会话展示：
  - 使用 `useConsoleStore` 的会话与命令列表，替换现有 `fetch('.../api/console/data')` 直接赋值的错误用法；修复字段命名不一致问题（API 返回 `sessions`/`websocket_clients`）。

## 主进程实现
- LogManager：在 `addLog()` 中为每条日志追加发布到 `DataManager.publish('system:logs', {...}, { ttlMs: 5min, persist: false })`；保持敏感信息脱敏逻辑不变。
- ApiServer：
  - 新增 `GET /sse/system/logs`：订阅 `system:logs` 频道，心跳与初始化最近 N 条（不持久化，仅内存队列）。
  - 新增 `GET /api/logs`：支持查询最近日志并按条件过滤；默认 `limit=200`。
  - 新增 `POST /api/logs/export`：按 `from_ts/to_ts/level=error/source?` 过滤、生成 JSON 文件，返回 `{success, filepath, count}`。
- 保持现有 `DiagnosticsService.generateDiagnosticPackage()` 不变；导出错误日志不依赖打包诊断。

## 非持久化与安全
- UI 内仅缓存当前会话日志（最多 1000 条），不写入数据库。
- 服务端 SSE 使用 `persist: false`（MessageCenter 不做持久化）。
- 保留 LogManager 文件写入用于通用诊断，但本功能不从文件反查；导出默认使用 UI 缓冲数据，若用户选择“包含历史文件”，再调用 `/api/logs`。
- 严格脱敏：沿用 LogManager 的 `sanitizeMessage()`；导出时再执行一次敏感字段过滤。

## 验证与兼容
- 静态类型检查与代码走查；不启动开发服务器、不编写/运行测试用例。
- 验证路由与 IPC 通道存在：`plugin.window.list`、`monitoring.pageStatus.query`、`system.getSystemLog`。
- 清理 Console.vue 中无效字段映射，删除旧版 HTTP 直赋值逻辑（遵循“严禁保留回退代码”）。

## 交付项
- 更新 `Console.vue` 完成日志视图与统计、筛选、导出。
- 主进程新增 SSE/查询/导出接口、LogManager 发布。
- 修复控制台页面数据结构与命名不一致。
- 代码完成后更新 `change/` 对应 `tasks.md` 状态，并进行一次自检清理无用函数/注释。

## 后续可选增强
- 虚拟列表优化（大规模日志时内存与渲染性能）。
- 行内来源图标与跳转（来自房间/插件的日志可跳转至对应页面）。
- 关键词高亮与正则搜索。