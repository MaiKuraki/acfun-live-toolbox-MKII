## 目标
- 补齐系统设置页所有交互的实际功能与主进程行为，确保设置可持久化并即时或重启后生效。

## 待实现功能
1. 保持登录
- 行为：开启时持久化令牌至磁盘；关闭时不再写盘，并清理已有令牌文件，但不影响当前会话。
- 方案：
  - 已在 TokenManager 中按 `auth.keepLogin` 控制持久化（已完成）。
  - 补充：新增公开方法清理仅“磁盘令牌”，并在 `system.updateConfig` 监听到关闭时调用，以清理 `secrets.json` 而不登出。

2. 后端服务端口
- 行为：用户设置的端口统一用于 HTTP/WS/SSE。
- 方案：主进程从 `server.port` 读取并用于 `ApiServer`（已完成）。
- 即时生效：端口变更需要重启服务；后续提供可选 IPC `server.restart`（本次先持久化，提示重启生效）。

3. 配置保存路径（选择/打开/导入/打包导出）
- 行为：
  - 选择并保存配置目录 `config.dir`
  - 打包导出当前配置为 zip
  - 从 zip 导入并覆盖当前配置
  - 打开当前配置目录
- 方案：
  - 已实现 `config.exportZip/config.importZip` IPC 与渲染层调用（已完成）。
  - 新增：`config.setDir(dir)` IPC；运行期写入 `config.dir` 并复制现有 `config.json/secrets.json` 至新目录；提示重启以完全切换。
  - 新增：在主进程启动早期读取默认 `userData/config.json` 的 `config.dir`，若存在则 `app.setPath('userData', dir)` 后再初始化 `ConfigManager`，实现重启后生效的目录迁移。

4. 最小化到系统托盘
- 行为：开启“最小化到系统托盘”后，最小化或关闭时隐藏窗口至托盘；托盘菜单提供“显示窗口”“退出”。
- 方案：
  - 新增 `TrayManager`：创建托盘图标、菜单与事件；依据 `ui.minimizeToTray` 开关管理窗口隐藏行为。
  - `WindowManager` 集成托盘事件：监听 `minimize/close` 根据设置隐藏而非退出。
  - 新增 IPC：`system.setMinimizeToTray(enabled)` 或在 `system.updateConfig` 中检测该键并即时应用。

5. 开机自启动
- 行为：开启后随系统登录启动应用；关闭后不启动。
- 方案：
  - 新增 IPC：`system.setAutoStart(enabled)`（或在 `system.updateConfig` 中检测 `app.autoStart`），调用 `app.setLoginItemSettings({ openAtLogin: enabled })`（win/mac 支持）。
  - 持久化键：`app.autoStart`

6. 关于页仓库地址
- 行为：链接指向“本仓库地址”。
- 方案：
  - 新增可配置键 `meta.repoUrl`，默认从 README 或预设地址，允许在设置中更新。
  - 渲染层关于页从配置读取并展示。

## 文件改动
- `packages/main/src/ipc/ipcHandlers.ts`
  - 扩展 `system.updateConfig`：监听 `auth.keepLogin/ui.minimizeToTray/app.autoStart/config.dir` 的即时动作（清理令牌文件、应用托盘、设置自启动、复制配置文件）。
  - 新增 IPC：`config.setDir(dir)`、可选 `server.restart`。
- `packages/main/src/bootstrap/TrayManager.ts`（新增）
  - 托盘图标与菜单管理、显示/退出逻辑。
- `packages/main/src/bootstrap/WindowManager.ts`
  - 集成 `TrayManager` 与隐藏行为（最小化/关闭事件）。
- `packages/main/src/index.ts`
  - 启动前读取 `userData/config.json` 的 `config.dir` 并 `app.setPath('userData', dir)`，随后构造 `ConfigManager`。
- `packages/preload/src/index.ts`
  - 暴露新 IPC：`system.setAutoStart`、`system.setMinimizeToTray`、`config.setDir`
- `packages/renderer/src/pages/Settings.vue`
  - 已支持端口、保持登录、配置路径与导入导出 UI（已完成）。
  - 扩展保存：写入 `ui.minimizeToTray/app.autoStart/meta.repoUrl` 并调用对应 IPC 以即时应用可用项。

## 生效与提示
- 端口与配置目录的完全切换需要重启应用；保存后提示“重启生效”。
- 保持登录关闭时立即清理磁盘令牌；当前会话不受影响。
- 最小化到托盘与自启动开关即时应用。

## 验证
- 类型检查：`pnpm -r run typecheck`
- 静态走查：确保未保留旧回退代码，删除无用注释/函数。

请确认以上方案后，我将开始实施具体代码改动并完成验证。